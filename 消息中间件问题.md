## 问题:

#### 说说你们公司线上生产环境用的是什么消息中间件？
kafka
#### 那你们线上系统是有哪些技术挑战，为什么必须要在系统里引入消息中间件？
- 异步操作(当操作成功发送短信提醒用户)
- 应用解耦(当订单创建时,风控服务也需要订单数据,此时由消息中间件做解耦操作)
- 削峰(活动功能抽奖由消息中间件来做后端第一层墙,防止流量过高导致宕机或响应超时)

#### 你们的消息中间件技术选型为什么是kafka？
- 因为在目前kafka在java的client里面已经可以实现每个client自我保持一个offset,只消费该offset之后的数据,同一个消息只会给一个服务消费一次(我们每一个消费也会做消费确认)
- 内置zk方便集成,防止因消息中间件宕机导致系统宕机

#### 为什么不用RocketMQ或者是RabbitMQ？技术选型的依据是什么？
- 分布式可高可扩展(不像RabbitMQ需要组件),kafka只需要zk很方便就集成
- 容错,当一台机子挂掉会自动由zk来使消费者去其他机器消费
- kafka的缺点
    - 重复消息 因为我们的client做了重复消费确认,所以并无关系
    - 消息乱序 多分区消息乱序,对于我们的系统消息先后没有什么影响.

#### 你们怎么保证消息中间件的高可用性？避免消息中间件故障后引发系统整体故障？
- 集群

#### 使用消息中间件技术的时候，你们怎么保证投递出去的消息一定不会丢失？
- 由消息中间件保证(kafka保证消息至少发送一次)消息至少发送一次
- 消息数据库记录和log记录

#### 你们怎么保证投递出去的消息只有一条且仅仅一条，不会出现重复的数据？
- 不保证发送只有一条
- 由client处理重复消息

#### 如果消费了重复的消息怎么保证数据的准确性？
- 由client处理重复消息

#### 你们线上业务用消息中间件的时候，是否需要保证消息的顺序性？
- 偶尔需要保证

#### 如果不需要保证消息顺序，为什么不需要？假如我有一个场景要保证消息的顺序，你们应该如何保证？
- kafka使用一个分区,多个分区时不保证消息的顺序

#### 下游消费系统如果宕机了，导致几百万条消息在消息中间件里积压，此时怎么处理？
- 如果是消费系统的代码问题,先修复消费系统代码
- 再开多个分区,然后临时启动多个consumer,以多倍速度来消费

#### 你们线上是否遇到过消息积压的生产故障？如果没遇到过，你考虑一下如何应对？
- 数据迁移时遇到,演练的时候是正常,正式迁移遇到问题,临时多个分区,本地机器加入consumer,实现快速消费

#### 你们用的是Kafka？那你说说Kafka的底层架构原理，磁盘上数据如何存储的，整体分布式架构是如何实现的？

#### 再说说Kafka是如何保证数据的高容错性的？零拷贝等技术是如何运用的？高吞吐量下如何优化生产者和消费者的性能？

#### 看过Kafka的源码没有。如果看过，说说你对Kafka源码的理解？

#### 你们用的是RocketMQ？RocketMQ很大的一个特点是对分布式事务的支持，你说说他在分布式事务支持这块机制的底层原理？

#### RocketMQ的源码看过么，聊聊你对RocketMQ源码的理解？

#### 如果让你来动手实现一个分布式消息中间件，整体架构你会如何设计实现？