### 消息队列

#### 为什么使用消息队列

1. 结合项目,查看当前项目业务具体场景,这个业务场景有什么问题,需要用到MQ,得到了什么好处.
(解耦,异步,削峰)

2. 解耦,pub/sub 分发机制(如果多个系统需要同一条消息)

3. 高延时优化,同步调用接口,因为接口存在时间,所以存在延迟

4. 使用Mq可以解决,不需要关心是否成功,延迟等问题,交由接收方自己处理(多次处理)


#### 消息队列有什么优点和缺点

##### 优点

1.解耦

2. 高延时优化

3. 大部分分布式场景(实现最终一致性)

##### 缺点

1. 系统可用性降低,耦合组件,组件宕机会出问题

2. 系统复杂度提高,重复消费等

3. 一致性问题,A成功,BC失败怎么办?(最终一致性解决方案)

#### 消息队列的区别 

1.  
- ActiveMq
偶尔会丢失消息,官方社区对acMq几乎不维护

- RabbitMq
erlang语言开发,性能极好,管理界面非常好,社区活跃,无法阅读源码

- RocketMq
在阿里大规模应用过,社区活跃度高,支持复杂Mq业务场景,分布式,易扩展,java源码

- Kafka
 天然适合大数据,扩展性强,吞吐量高


 #### 如何保证消息队列的高可用

 ##### RabbitMq

 1. 高可用

 - 普通集群策略
 缺点:
 	1.rabbitMq集群内有大量互相调用
 	2.存储元数据的机器宕机则数据丢失
 - 镜像集群
 优点:
 	1. 每个机器存储有所有消息
 	2. 配置简单,管理后台修改即可
 缺点:
 	1. 存储大量数据
 ##### kafka
  1.高可用
  内部使用leader staff
  每一个topic的partition都有一个leader,多个staff,staff存储有所有备份
  所有外部交互都通过leader,staff存储有所有备份,如果出现问题,则将当前staff升级为leader.